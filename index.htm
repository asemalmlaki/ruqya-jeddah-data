<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ù†Ù…ÙˆØ°Ø¬ Ù„Ø¬Ù†Ø© Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/themes/material_blue.css">
    <style>
        html {
            scroll-behavior: smooth; /* Ø­Ø±ÙƒØ© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù†Ø§Ø¹Ù…Ø© */
        }
        /* New Color Palette */
        :root {
            --primary-color: #1E3A8A;
            /* Royal Blue */
            --secondary-color: #10B981;
            /* Mint Green */
            --background-color: #F9FAFB;
            /* Soft Gray */
            --text-color: #1F2937;
            /* Dark Gray */
            --card-background: #FFFFFF;
            /* White for cards/fields */
            --shadow-color: rgba(0, 0, 0, 0.08);
            /* Soft Shadow */
            --button-text-color: #FFFFFF;
            /* White text for buttons */
            --focus-border-color: #1E3A8A;
            /* Royal Blue for focus */
            --yes-color: #10B981;
            /* Mint green for Yes */
            --no-color: #EF4444;
            /* Red for No */
            --warning-color: #F59E0B;
            /* Amber for warnings */

            /* New Button Colors */
            --submit-button-color: var(--secondary-color);
            /* Mint Green for Submit */
            --update-button-color: var(--primary-color);
            /* Royal Blue for Update */
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--background-color);
            margin: 0;
            color: var(--text-color);
            line-height: 1.6;
            direction: rtl;
            /* Ensure Right-to-Left direction */
            text-align: right;
            /* Ensure text alignment is right */
        }

        header,
        footer {
            background-color: var(--card-background);
            /* Use white for header/footer background */
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px var(--shadow-color);
            /* Adjusted shadow */
        }

        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        header img {
            height: 100px;
            /* Increased Header Logo Size */
            margin-bottom: 10px;
        }

        header h1 {
            font-size: 1.8em;
            /* Slightly larger font size */
            font-weight: 700;
            /* Bold font for headings */
             color: var(--primary-color); /* ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø£Ø³ÙˆØ¯ */
            margin: 0 0 15px 0;
            /* Added more bottom margin */
            text-align: center;
        }

        .location-highlight { /* ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©: Ù„ØªÙ„ÙˆÙŠÙ† Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
             color: var(--primary-color); 
        }

        /* Style for Header Links Container (moved outside header) */
        .header-links {
            text-align: center;
            /* Center the links/buttons */
            margin-top: 10px;
            /* Space below the header */
            margin-bottom: 20px;
            /* Space above the main container */
        }

        .header-links a {
            margin: 0 15px;
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 400;
            /* Regular weight for links */
            font-size: 1.1em;
            transition: color 0.3s ease;
            /* Style links as buttons for better appearance */
            display: inline-block;
            padding: 8px 15px;
            border: 1px solid var(--primary-color);
            border-radius: 5px;
            background-color: #fff;
            transition: background-color 0.3s, color 0.3s;
        }

        .header-links a:hover {
            color: #fff;
            background-color: var(--primary-color);
        }

        .container {
            max-width: 1000px;
            /* Increased max width */
            margin: 20px auto;
            padding: 0 20px;
            /* Add some padding on the sides */
            display: grid;
            /* grid-template-columns is controlled by JS based on section visibility */
            gap: 30px;
            /* Space between columns (or rows when stacked) */
        }

        @media screen and (max-width: 900px) {
            .container {
                grid-template-columns: 1fr !important;
                /* Always stack columns on smaller screens */
            }
        }


        .form-container {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 10px;
            /* More rounded corners */
            box-shadow: 0 4px 12px var(--shadow-color);
            /* Softer, larger shadow */
            border: 1px solid #eee;
            /* Lighter border */
        }

        .report-container {
            background-color: var(--card-background);
            /* White background */
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px var(--shadow-color);
            /* Soft shadow */
            border: none;
            /* No border */
        }

        label {
            display: block;
            margin-bottom: 6px;
            /* Slightly more space */
            color: var(--text-color);
            /* Dark gray color */
            font-weight: 700;
            /* Bold labels */
            font-size: 0.95em;
            /* Slightly smaller font */
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            /* Increased padding */
            margin-bottom: 20px;
            /* More space below fields */
            border: 1px solid #ddd;
            /* Lighter border */
            border-radius: 6px;
            /* Slightly more rounded */
            font-family: 'Tajawal', sans-serif;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: #fefefe;
            /* Very light background for fields */
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--focus-border-color);
            outline: none;
            box-shadow: 0 0 8px rgba(30, 58, 138, 0.2);
            /* Shadow matching primary color */
            background-color: #fff;
        }

        textarea {
            resize: vertical;
            min-height: 150px;
            /* Increased min height */
        }

        /* Button Styling */
        button {
            color: var(--button-text-color);
            padding: 12px 25px;
            /* Increased padding */
            border: none;
            border-radius: 8px;
            /* More rounded buttons */
            cursor: pointer;
            font-size: 1.05em;
            /* Slightly larger font */
            font-weight: 700;
            /* Bold button text */
            transition: opacity 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            margin-right: 15px;
            /* More space between buttons */
            box-shadow: 0 4px 8px var(--shadow-color);
            /* Soft shadow */
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            /* Slight lift effect */
            box-shadow: 0 6px 12px var(--shadow-color);
            /* Larger shadow on hover */
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        /* Specific style for the Search button */
        #search-button {
            background: none;
            background-color: var(--primary-color);
            /* Solid primary color */
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        #search-button:hover {
            background-color: var(--secondary-color);
            /* Change to secondary on hover */
        }

        /* Specific style for the Submit button */
        button[type="submit"] {
            background-color: var(--submit-button-color);
            /* Mint Green */
        }

        button[type="submit"]:hover {
            background-color: #0B9B6B;
            /* Slightly darker mint green on hover */
        }

        /* Specific style for the Update button */
        #update-button {
            background-color: var(--update-button-color);
            /* Royal Blue */
        }

        #update-button:hover {
            background-color: #162C6A;
            /* Slightly darker royal blue on hover */
        }

        /* Style for Print PDF Button - Updated Color */
        #print-pdf-button {
            background-color: #ddc454; /* ÙƒØ§Ù† Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙƒÙ†ØŒ Ø±Ø¨Ù…Ø§ ØªØ±ØºØ¨ ÙÙŠ ØªØºÙŠÙŠØ±Ù‡ Ù„ÙŠØªÙ†Ø§Ø³Ù‚ */
        }

        #print-pdf-button:hover {
            background-color: #1f2021;
        }

        /* Style for Get Location Button */
        #get-location-button {
            background-color: #06B6D4;
            /* Cyan color */
        }

        #get-location-button:hover {
            background-color: #0891B2;
            /* Darker cyan on hover */
        }

        /* Styles for Signature Canvas */
        .signature-pad {
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fff;
            cursor: crosshair;
            touch-action: none;
            /* Prevent scrolling when drawing on touch devices */
            width: 100%;
            /* Make it responsive */
            height: 150px;
            /* Set a fixed height */
            margin-bottom: 10px;
            /* Space below the canvas */
        }

        /* Styles for Clear Signature Button */
        .clear-signature {
            background-color: #EF4444;
            /* Red color for clear button */
            color: white;
            padding: 6px 12px;
            /* Smaller padding */
            font-size: 0.85em;
            /* Smaller font size */
            margin-top: 5px;
            /* Small space above the button */
            margin-bottom: 20px;
            /* Space after the button */
            display: block;
            width: fit-content;
        }

        .clear-signature:hover {
            background-color: #DC2626;
            /* Darker red on hover */
        }


        .success {
            text-align: center;
            color: var(--secondary-color);
            /* Green color for success */
            font-weight: 700;
            margin-top: 20px;
            font-size: 1.1em;
        }

        .criteria-section {
            background-color: var(--card-background);
            padding: 25px;
            /* Increased padding */
            border-radius: 10px;
            margin-bottom: 25px;
            /* More space below */
            box-shadow: 0 2px 8px var(--shadow-color);
            /* Card shadow */
            border: 1px solid #eee;
        }

        .criteria-section h3 {
            color: var(--primary-color);
            /* Primary color for section title */
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 700;
            border-bottom: 2px solid var(--secondary-color);
            /* Underline with secondary color */
            padding-bottom: 10px;
        }

        .criterion {
            margin-bottom: 20px;
            /* More space between criteria */
            padding: 15px;
            border: 1px solid #eee;
            /* Border around each criterion */
            border-radius: 8px;
            /* Rounded corners for criteria cards */
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            /* Light shadow for criterion card */
            background-color: #fcfcfc;
            /* Slightly different background for criterion card */
        }

        .criterion:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .criterion-label {
            display: block;
            margin-bottom: 10px;
            /* More space below label */
            font-weight: 400;
            /* Regular weight for criterion text */
            color: var(--text-color);
            font-size: 1em;
        }

        .options {
            display: flex;
            gap: 20px;
            /* Increased space between options */
            margin-top: 8px;
        }

        .options label {
            display: flex;
            align-items: center;
            gap: 8px;
            /* Space between radio button and text */
            font-weight: 400;
            /* Regular weight for options */
            color: var(--text-color);
            cursor: pointer;
            /* Indicate clickable */
        }

        .criterion .options label.yes {
            color: var(--yes-color);
            font-weight: 700;
            /* Bold Yes */
        }

        .criterion .options label.no {
            color: var(--no-color);
            font-weight: 700;
            /* Bold No */
        }

        .yes input {
            accent-color: var(--yes-color);
        }

        .no input {
            accent-color: var(--no-color);
        }

        /* Style for warning message next to criteria */
        .warning-message {
            color: var(--warning-color);
            font-weight: 700;
            margin-top: 10px;
        }

        .warning-message.hidden {
            display: none;
        }

        /* ØªØ°ÙŠÙŠÙ„ Ø¨Ø³ÙŠØ· */
        footer {
            margin-top: 40px;
            /* More space above footer */
            padding: 20px;
            /* Keep padding */
            text-align: center;
            /* Keep centering */
            box-shadow: 0 2px 8px var(--shadow-color);
            /* Keep shadow */
            background-color: var(--card-background);
            /* Keep background */
            font-size: 0.9em;
            color: var(--text-color);
            display: flex;
            /* Use flex for centering text */
            flex-direction: column;
            /* Stack items (though only one text item now) */
            align-items: center;
            justify-content: center;
            /* Center vertically */
        }

        /* Remove style for footer img as the img tag is removed */
        footer img {
            display: none;
            /* Hide the logo */
        }


        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media screen and (max-width: 600px) {
            .form-container,
            .report-container {
                padding: 20px;
                margin: 10px 0;
            }

            header {
                flex-direction: column;
                align-items: center;
            }

            header img {
                margin-left: 0;
                margin-bottom: 10px;
            }

            /* --- ØªØ¹Ø¯ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ø¬ÙˆØ§Ù„ --- */
            .header-links {
                display: flex; 
                justify-content: center; 
                flex-wrap: wrap; 
                gap: 5px; 
            }

            .header-links a {
                padding: 6px 10px; 
                font-size: 0.9em; 
                margin: 5px 5px; 
                flex-grow: 1; 
                text-align: center; 
            }
            /* --- Ù†Ù‡Ø§ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© --- */


            button { /* Ù‡Ø°Ø§ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯Ù‡ Ø¹Ø§Ù…Ù‹Ø§ Ù‡ÙƒØ°Ø§ */
                width: 100%;
                margin-right: 0;
                margin-bottom: 15px;
            }
             /* Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ø¹ÙŠÙ†Ø© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± */
            .header-links button { /* Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ header-links Ù‡ÙŠ Ø£Ø²Ø±Ø§Ø± ÙØ¹Ù„ÙŠØ© ÙˆÙ„ÙŠØ³Øª Ø±ÙˆØ§Ø¨Ø· <a> */
                width: auto; /* Ø£Ùˆ flex-grow: 1; Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯Ù‡Ø§ Ø£Ù† ØªØªÙ…Ø¯Ø¯ */
            }
             #search-container button, 
            .form-container > form > button, /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø§Ù„ÙÙˆØ±Ù… */
            .clear-signature {
                width: auto; /* Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ø¹ÙŠÙ†Ø© */
            }
            .form-container > form > button { /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø§Ù„ÙÙˆØ±Ù… (Ø¥Ø±Ø³Ø§Ù„ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ Ø·Ø¨Ø§Ø¹Ø©) */
                 width: calc(33.333% - 10px); /* Ù…Ø«Ø§Ù„ Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ø«Ù„Ø§Ø«Ø© ÙÙŠ Ø§Ù„ØµÙ Ù…Ø¹ Ù…Ø³Ø§ÙØ§Øª */
                 margin-left: 5px;
                 margin-right: 5px;
            }
             .form-container > form > button:last-child {
                 margin-left: 0; /* Ø£Ùˆ margin-right: 0 Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø²Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
             }


            .container {
                padding: 0 10px;
            }

            .member-input {
                flex-direction: column;
                /* Stack items vertically on small screens */
                align-items: stretch;
                /* Stretch items to fill width */
            }

            .member-details {
                width: 100%;
                /* Allow details to take full width */
                margin-top: 10px;
                /* Add space above details when stacked */
            }

            /* New styles for location input group on small screens */
            .location-input-group {
                flex-direction: column;
                /* Stack input and button vertically */
                gap: 15px;
                /* Adjust gap when stacked */
            }

            .location-input-group input,
            .location-input-group button {
                width: 100%;
                /* Make them full width */
                margin-bottom: 0 !important;
                /* Remove individual margins */
            }

        }


        /* Style for the search box container */
        .search-container {
            margin-bottom: 25px;
            /* More space below search */
            padding: 20px;
            background-color: #f1f5f9;
            /* Lighter background for search */
            border: 1px solid #d1d5db;
            border-radius: 8px;
            display: flex;
            gap: 15px;
            /* More space between elements */
            align-items: center;
            box-shadow: 0 1px 4px var(--shadow-color);
            flex-wrap: wrap;
            /* Allow wrapping on smaller screens */
        }

        .search-container label {
            font-weight: 400;
            margin-bottom: 0;
            color: var(--text-color);
            flex-shrink: 0;
            /* Prevent label from shrinking */
        }

        .search-container input[type="text"] {
            flex-grow: 1;
            margin-bottom: 0;
            min-width: 150px;
            /* Ensure input has a minimum width */
        }

        .search-container button {
            margin-right: 0;
            flex-shrink: 0;
            /* Prevent button from shrinking */
        }

        /* Style for the Power BI embed container */
        .powerbi-container {
            margin-top: 0;
            /* Removed top margin as it's handled by grid gap */
            border-radius: 10px;
            overflow: hidden;
            /* Moved box-shadow and border to report-container */
        }

        /* Style for the report container itself */
        .report-container {
            background-color: var(--card-background);
            /* White background */
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px var(--shadow-color);
            /* Soft shadow */
            border: none;
            /* No border */
        }


        .powerbi-container iframe {
            display: block;
            width: 100%;
            height: 600px;
            /* Kept original height */
            border: none;
        }

        /* CSS to hide elements */
        .hidden {
            display: none;
        }

        /* Styling for the members section - Updated */
        .members-section {
            background-color: var(--card-background);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px var(--shadow-color);
            /* Card shadow */
            border: 1px solid #eee;
            margin-top: 40px;
            /* Added space above members section */
        }

        .members-section h3 {
            color: var(--primary-color);
            /* Primary color for section title */
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 700;
            border-bottom: 2px solid var(--secondary-color);
            /* Underline with secondary color */
            padding-bottom: 10px;
        }

        .member-input {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            /* Align items to the top */
            gap: 10px;
            background-color: #fcfcfc;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #eee;
            flex-wrap: wrap;
        }

        .member-logo {
            height: 70px;
            /* Increased Member Logo Size */
            width: auto;
            flex-shrink: 0;
            margin-top: 5px;
            /* Align logo slightly down */
        }

        .member-details {
            /* Styles for the container holding name, signature, date */
            display: flex;
            flex-direction: column;
            /* Stack contents vertically */
            flex-grow: 1;
            /* Allow to take available space */
            min-width: 0;
            /* Allow shrinking */
        }

        .member-details label {
            margin-bottom: 5px;
            /* Space between labels and inputs */
            font-weight: 400;
            font-size: 1em;
            display: block;
            /* Ensure labels are block elements */
        }

        .member-details input[type="text"],
        .member-details input[type="date"] {
            margin-bottom: 10px;
            /* Space below each input */
            width: 100%;
            /* Ensure inputs fill the container */
            box-sizing: border-box;
            /* Include padding and border in the element's total width */
        }

        .member-details input[type="text"]:last-child,
        .member-details input[type="date"]:last-child {
            margin-bottom: 0;
            /* No bottom margin for the last input in the details */
        }


        /* Styling for the report title when it's outside the container */
        .report-title {
            color: var(--primary-color);
            font-size: 1.8em;
            /* Slightly larger font size */
            font-weight: 700;
            /* Bold font */
            text-align: center;
            margin-bottom: 20px;
            /* Space below the title */
            margin-top: 0;
        }

        /* Styling for Final Evaluation */
        #final-evaluation {
            margin-top: 25px;
            margin-bottom: 40px;
            /* Added space below final evaluation */
            font-size: 1.2em;
            font-weight: 700;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background-color: #e0f2f7;
            /* Light blue background */
        }

        #final-evaluation.qualified {
            background-color: #d1fae5;
            /* Light green */
            color: var(--secondary-color);
        }

        #final-evaluation.needs-review {
            background-color: #fef3c7;
            /* Light yellow */
            color: var(--warning-color);
        }

        #final-evaluation.not-qualified {
            background-color: #fee2e2;
            /* Light red */
            color: var(--no-color);
        }

        /* Style for QR Code Section - Removed */
        .qr-code-container {
            display: none;
            /* Hide the container */
        }


        /* Style for Scroll to Top Button */
        #scroll-to-top {
            position: fixed;
            /* Stay in place */
            bottom: 20px;
            /* Distance from the bottom */
            right: 20px;
            /* Distance from the right */
            z-index: 1000;
            /* Ensure it's above other content */
            padding: 10px 15px;
            background-color: var(--primary-color);
            /* Use primary color */
            color: var(--button-text-color);
            /* White text */
            border: none;
            border-radius: 50%;
            /* Make it round */
            font-size: 1.5em;
            line-height: 1;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s, visibility 0.3s;
            opacity: 0;
            /* Initially hidden */
            visibility: hidden;
            /* Initially hidden */
        }

        #scroll-to-top.visible {
            opacity: 1;
            /* Show when visible class is added */
            visibility: visible;
            /* Show when visible class is added */
        }

        #scroll-to-top:hover {
            background-color: var(--secondary-color);
            /* Change color on hover */
        }

        /* Styles for Print PDF */
        @media print {
            body {
                background-color: #fff;
                margin: 0;
                padding: 0;
            }

            header,
            footer,
            .header-links,
            .search-container,
            button, /* Ø³ÙŠØ®ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±ØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³Ø­ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ù† Ù†ÙˆØ¹ button */
            .clear-signature, /* ØªØ£ÙƒÙŠØ¯ Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³Ø­ */
            #msg,
            .report-section-container, /* Ø§Ø³Ù… Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± */
            #scroll-to-top {
                display: none !important;
            }
            
            #input-section { /* Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
                display: block !important;
            }

            /* ØªØ£ÙƒØ¯ Ø£Ù† printable-form-content Ù‡Ùˆ Ù…Ø§ ØªØ±ÙŠØ¯ Ø·Ø¨Ø§Ø¹ØªÙ‡ ÙˆØ£Ù† Ù„Ù‡ Ù…Ø­ØªÙˆÙ‰ */
             #printable-form-content { /* Ø£Ùˆ #print-area Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ³ØªØ®Ø¯Ù…Ù‡ */
                display: block !important;
                width: 100%; /* Ø£Ùˆ 210mm Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ³ØªÙ‡Ø¯Ù A4 Ø¨Ø´ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚ */
                margin: 0 auto;
                padding: 10mm; /* Ø£Ùˆ 15mm */
                box-sizing: border-box;
                color: black;
                font-size: 11pt;
                box-shadow: none;
                border: none;
            }
            
            #printable-form-content input,
            #printable-form-content select,
            #printable-form-content textarea {
                border: none !important; /* Ø§Ø³ØªØ®Ø¯Ø§Ù… !important Ù„Ø¶Ù…Ø§Ù† ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø®Ø±Ù‰ */
                background-color: transparent !important;
                padding: 0 !important;
                margin-bottom: 5px !important;
                font-family: 'Tajawal', sans-serif !important;
                font-size: 11pt !important;
                color: black !important;
                box-shadow: none !important; /* Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¸Ù„Ø§Ù„ */
                -webkit-appearance: none; /* Ø¥Ø²Ø§Ù„Ø© Ù…Ø¸Ù‡Ø± Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
                -moz-appearance: none;
                appearance: none;
            }
             /* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ select Ø¥Ù„Ù‰ Ù†Øµ Ø¸Ø§Ù‡Ø± */
            #printable-form-content select {
                border: none !important;
                /* ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… JavaScript Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¥Ù„Ù‰ Ù†Øµ Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
            }

            /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ø±Ø§Ø¯ÙŠÙˆ ÙˆØ§Ù„ØªØ´ÙŠÙƒ Ø¨ÙˆÙƒØ³ */
            #printable-form-content input[type="radio"]:checked::after,
            #printable-form-content input[type="checkbox"]:checked::after {
                content: attr(value); /* Ù‚Ø¯ Ù„Ø§ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØµÙØ­Ø§ØªØŒ Ø¨Ø¯ÙŠÙ„ Ù‡Ùˆ JS */
                display: inline-block;
                margin-left: 5px;
            }
             #printable-form-content input[type="radio"],
            #printable-form-content input[type="checkbox"] {
                 display: inline-block; /* Ø£Ùˆ none Ø¥Ø°Ø§ ÙƒÙ†Øª Ø³ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ JS Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚ÙŠÙ…Ø© */
                 width: auto;
                 margin-right: 5px;
            }


            #printable-form-content label {
                font-weight: bold; /* Ø¬Ø¹Ù„ Ø§Ù„Ù„ÙŠØ¨Ù„Ø§Øª bold ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
                display: inline;
                margin-bottom: 0;
                padding-left: 5px;
            }

            /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
            #printable-form-content h1,
            #printable-form-content h2,
            #printable-form-content h3 {
                color: black !important;
                border-bottom: 1px solid #ccc !important;
                padding-bottom: 5px !important;
                margin-bottom: 15px !important;
            }

            /* Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ù„Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª */
            #printable-form-content img.signature-image { /* Ø§ÙØªØ±Ø¶ Ø£Ù†Ùƒ Ø³ØªØ¶ÙŠÙ ÙƒÙ„Ø§Ø³ Ù„Ù„ØµÙˆØ± Ø§Ù„Ù†Ø§ØªØ¬Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ */
                max-width: 150px !important; /* ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø£Ù‚ØµÙ‰ Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ */
                height: auto !important;
                display: block !important; /* Ø£Ùˆ inline-block Ø­Ø³Ø¨ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ */
                margin-top: 5px;
                border: 1px solid #eee; /* Ø­Ø¯ Ø®ÙÙŠÙ Ø­ÙˆÙ„ ØµÙˆØ±Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ */
            }
            
            .signature-pad { /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ù†ÙØ³Ù‡ */
                display: none !important;
            }
            /* ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ø¯ÙŠÙƒ Ù…Ù†Ø·Ù‚ ÙÙŠ JS Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ø¥Ù„Ù‰ <img> Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¥Ø°Ø§ Ù„Ù… ØªØ³ØªØ®Ø¯Ù… html2pdf */
            /* html2pdf ÙŠØ¹Ø§Ù„Ø¬ Ù‡Ø°Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ */
        }
    </style>
</head>

<body>

    <div id="login-overlay" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        display: none; /* Initially hide the overlay */
        justify-content: center;
        align-items: center;
        z-index: 9999;
        ">
        <div style="
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
            ">
            <h2 style="color: var(--primary-color);">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <input type="text" id="username-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" style="margin-bottom: 15px; text-align: center;">
            <input type="password" id="password-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="margin-bottom: 20px; text-align: center;">
            <button type="button" id="login-button" style="background-color: var(--primary-color);">Ø¯Ø®ÙˆÙ„</button>
            <button type="button" id="guest-button" style="background-color: #6B7280; margin-right: 10px;">Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±</button>
            <p id="login-message" style="color: red; margin-top: 15px;"></p>
        </div>
    </div>
    <header>
        <img src="iemg/e-logo.svg" alt="Logo">
        <h1>Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø²Ø§ÙˆÙ„ÙŠ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©<span class="location-highlight">Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø¬Ø¯Ø©</span></h1>
    </header>

    <div class="header-links">
        <a href="#" id="input-link">ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø¯Ø®Ø§Ù„</a>
        <a href="#" id="report-link">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</a>
        <a href="#" id="login-toggle-link">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a> <a href="#" id="logout-link" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a> </div>


    <div class="container">
        <div class="form-container" id="input-section">
            <div class="search-container" id="search-container">
                <label for="search-id">Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</label>
                <input type="text" id="search-id" name="search-id" pattern="\d{10}" maxlength="10"
                    title="ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…">
                <button type="button" id="search-button">Ø¨Ø­Ø«</button>
            </div>


            <form id="form">
                <div id="printable-form-content"> <label for="name">Ø§Ù„Ø§Ø³Ù…</label>
                    <input type="text" id="name" name="name" required>

                    <label for="id">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                    <input type="text" id="id" name="id" pattern="\d{10}" maxlength="10" title="ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…"
                        required>

                    <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                    <input type="text" id="phone" name="phone" pattern="\d{10}" maxlength="10"
                        title="ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…" required>

                    <label for="practitioner_location_coords">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø²Ø§ÙˆÙ„ (Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª)</label>
                    <div class="location-input-group" style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <input type="text" id="practitioner_location_coords" name="practitioner_location_coords"
                            placeholder="Ø³ÙŠØªÙ… Ø§Ù„ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹"
                            style="flex-grow: 1; margin-bottom: 0;" required>
                        <button type="button" id="get-location-button" style="margin-bottom: 0; flex-shrink: 0;">ØªØ­Ø¯ÙŠØ¯
                            Ù…ÙˆÙ‚Ø¹ÙŠ ğŸ“</button>
                    </div>
                    <input type="hidden" id="practitioner_location" name="practitioner_location">


                    <label for="nationality">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</label>
                    <select id="nationality" name="nationality" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <option>Ø³Ø¹ÙˆØ¯ÙŠ</option>
                        <option>ØºÙŠØ± Ø³Ø¹ÙˆØ¯ÙŠ</option>
                    </select>

                    <label for="status">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</label>
                    <select id="status" name="status" required>
                        <option>Ø£Ø¹Ø²Ø¨</option>
                        <option>Ù…ØªØ²ÙˆØ¬</option>
                    </select>

                    <label for="dob">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                    <input type="text" id="dob" name="dob" required>
                    <label for="education">Ø§Ù„Ù…Ø¤Ù‡Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</label>
                    <select id="education" name="education" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <option>Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
                        <option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                        <option>Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³</option>
                        <option>Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option>Ù…ØªÙˆØ³Ø·</option>
                        <option>Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    </select>

                    <label for="gender">Ø§Ù„Ø¬Ù†Ø³</label>
                    <select id="gender" name="gender" required>
                        <option>Ø°ÙƒØ±</option>
                        <option>Ø£Ù†Ø«Ù‰</option>
                    </select>

                    <label for="practice_type">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø²Ø§ÙˆÙ„Ø©</label>
                    <select id="practice_type" name="practice_type" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <option>Ø±Ø§Ù‚ÙŠ Ø´Ø±Ø¹ÙŠ</option>
                        <option>Ù…Ø¹Ø§Ù„Ø¬ Ø´Ø¹Ø¨ÙŠ</option>
                        <option>Ù…ÙØ³Ø± Ø£Ø­Ù„Ø§Ù…</option>
                    </select>

                    <label for="profession">Ø§Ù„Ù…Ù‡Ù†Ø©</label>
                    <select id="profession" name="profession" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <option>Ù…ØªØ³Ø¨Ø¨</option>
                        <option>Ù…ÙˆØ¸Ù</option>
                    </select>

                    <label for="previously_prevented">Ù‡Ù„ Ø³Ø¨Ù‚ Ø£Ù† ØªÙ… Ù…Ù†Ø¹Ù‡ØŸ</label>
                    <select id="previously_prevented" name="previously_prevented" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <option>Ù†Ø¹Ù…</option>
                        <option>Ù„Ø§</option>
                    </select>

                    <label for="practice_status">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§ÙˆÙ„</label>
                    <select id="practice_status" name="practice_status" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <option>Ù…Ø³ØªÙ…Ø±</option>
                        <option>Ù…Ù†Ù‚Ø·Ø¹</option>
                        <option>ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù</option>
                    </select>

                    <label for="visit_type">Ø±Ù‚Ù… Ø§Ù„Ø²ÙŠØ§Ø±Ø©</label>
                    <select id="visit_type" name="visit_type" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <script>
                            for (let i = 1; i <= 10; i++) {
                                document.write(`<option>${i}</option>`);
                            }
                        </script>
                    </select>

                    <label for="meeting_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¶Ø±</label>
                    <input type="text" id="meeting_date" name="meeting_date" required>
                    <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø¬Ù†Ø©</label>
                    <textarea id="notes" name="notes"></textarea>

                    <label for="opinion">Ø±Ø£ÙŠ Ø§Ù„Ù„Ø¬Ù†Ø©</label>
                    <textarea id="opinion" name="opinion"></textarea>

                    <div class="criteria-section">
                        <h3>Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>

                        <div class="criterion" data-criterion-type="positive"> <span class="criterion-label">Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù†
                                Ø§Ù„ÙƒØ±ÙŠÙ…ØŒ Ù…ØªÙˆÙØ± ÙÙŠÙ‡ Ø§Ù„ØµÙ„Ø§Ø­ØŒ Ø§Ù„Ø¥ØªÙ‚Ø§Ù† Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ø±Ù‚ÙŠØ© ÙˆØ¹Ù„Ù‰ Ù‚Ø¯Ø± Ù…Ù† Ø§Ù„Ø¹Ù„Ù… Ø¨Ø§Ù„Ø´Ø±ÙŠØ¹Ø©</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria1" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria1" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="positive">
                            <span class="criterion-label">ÙˆØ¬ÙˆØ¯ ÙƒØ´Ù Ø·Ø¨ÙŠ ÙŠØ¶Ù…Ù† Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø±Ø§Ù‚ÙŠ Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ù…Ù† Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø¹Ø¯ÙŠØ©
                                (ØµÙ„Ø§Ø­ÙŠØªÙ‡ Ø³ØªØ© Ø£Ø´Ù‡Ø±)</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria2" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria2" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="negative"> <span class="criterion-label">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠ
                                Ø£Ø³Ù„ÙˆØ¨ Ù…Ù† Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªØ¹Ø°ÙŠØ¨ ÙƒØ§Ù„Ø¶Ø±Ø¨ Ø£Ùˆ Ø§Ù„Ø®Ù†Ù‚ Ø£Ùˆ Ø§Ù„ØµØ¹Ù‚ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ø£Ùˆ Ø®Ù„Ø§ÙÙ‡</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria3" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria3" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="neutral-positive"> <span class="criterion-label">Ø§Ø³ØªØ®Ø¯Ø§Ù…
                                Ø§Ù„ÙˆØ§ÙØ¯ÙŠÙ† Ù…Ø¹ Ø§Ù„Ù…Ø²Ø§ÙˆÙ„</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria4" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria4" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                        </div>

                        <div class="criterion" data-criterion-type="negative">
                            <span class="criterion-label">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© Ø£Ùˆ Ù…ÙƒØ¨Ø±Ø§Øª Ø§Ù„ØµÙˆØª</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria5" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria5" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="positive"> <span class="criterion-label">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¹Ù„Ù‰
                                Ø§Ù„Ù†Ø³Ø§Ø¡ Ø¨ÙˆØ¬ÙˆØ¯ Ù…Ø­Ø±Ù…</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria6" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria6" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="negative">
                            <span class="criterion-label">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ© Ø£Ùˆ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØªÙŠØ© ÙˆÙ…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙˆØ§ØµÙ„
                                Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù† Ø£Ùˆ Ù„Ù„ØªØ³ÙˆÙŠÙ‚</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria7" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria7" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="negative">
                            <span class="criterion-label">ÙˆØ¬ÙˆØ¯ Ù…Ø³Ù…ÙŠØ§Øª Ù„Ù„Ù…Ø²Ø§ÙˆÙ„ Ù…Ø«Ù„ Ø§Ù„Ø±ÙˆØ­Ø§Ù†ÙŠ Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø£Ùˆ Ø®Ù„Ø§Ù Ø°Ù„Ùƒ</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria8" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria8" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="neutral-positive"> <span
                                class="criterion-label">Ø§Ù„Ø§Ø´ØªØ±Ø§Ø· Ø¨Ù…Ø¨Ø§Ù„Øº Ù…Ø§Ù„ÙŠØ©</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria9" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria9" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                        </div>

                        <div class="criterion" data-criterion-type="negative">
                            <span class="criterion-label">Ø¨ÙŠØ¹ Ø§Ù„Ù…Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø£Ø¹Ø´Ø§Ø¨ Ø£Ùˆ Ø§Ù„Ø²ÙŠÙˆØª Ø£Ùˆ Ø§Ù„Ø¹Ø³Ù„ Ø£Ùˆ Ø§Ù„Ø®Ù„Ø·Ø§Øª Ù…Ø¬Ù‡ÙˆÙ„Ø©
                                Ø§Ù„Ù…ØµØ¯Ø±</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria10" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria10" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="negative">
                            <span class="criterion-label">ÙˆØ¶Ø¹ Ù„ÙˆØ­Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ù„Ù…Ù‚Ø± Ø§Ù„Ù…Ø²Ø§ÙˆÙ„</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria11" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria11" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="positive">
                            <span class="criterion-label">ØªÙˆÙØ± ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ù…Ù‚Ø± Ø§Ù„Ù…Ø²Ø§ÙˆÙ„</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria12" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria12" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="neutral-positive"> <span class="criterion-label">Ø§Ù„ØªÙ†Ù‚Ù„
                                Ø¨ÙŠÙ† Ø§Ù„Ù…Ù†Ø§Ø²Ù„ Ù„Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ© Ø£Ùˆ Ø§Ù„Ø·Ø¨ Ø§Ù„Ø´Ø¹Ø¨ÙŠ</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria13" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria13" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                        </div>

                        <div class="criterion" data-criterion-type="negative">
                            <span class="criterion-label">ÙˆØ¬ÙˆØ¯ Ø£Ø°Ù‰ Ù…Ù† Ø§Ù„Ù…Ø²Ø§ÙˆÙ„ Ù„Ø¬ÙŠØ±Ø§Ù†Ù‡ Ù…Ø«Ù„ Ø§Ø²Ø¯Ø­Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø£Ù…Ø§Ù… Ø§Ù„Ù…Ù‚Ø± Ø£Ùˆ Ø®Ù„Ø§Ù
                                Ø°Ù„Ùƒ</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria14" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria14" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                        <div class="criterion" data-criterion-type="positive">
                            <span class="criterion-label">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§Ø²ÙŠØ© ÙˆØ§Ù„ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</span>
                            <div class="options">
                                <label class="yes"><input type="radio" name="criteria15" value="Ù†Ø¹Ù…" required> Ù†Ø¹Ù…</label>
                                <label class="no"><input type="radio" name="criteria15" value="Ù„Ø§" required> Ù„Ø§</label>
                            </div>
                            <div class="warning-message hidden">
                                âš ï¸ Ù‡Ø°Ø§ Ù…Ø®Ø§Ù„Ù Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù„Ø¬Ù†Ø©. </div>
                        </div>

                    </div>

                    <div id="final-evaluation"></div>

                    <div class="members-section">
                        <h3>Ø£Ø³Ù…Ø§Ø¡ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø²ÙŠØ§Ø±Ø© ÙˆØªÙˆÙ‚ÙŠØ¹Ø§ØªÙ‡Ù…</h3>

                        <div class="member-input">
                            <img src="iemg/ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø§Ø³Ù„Ø§Ù…ÙŠØ©.svg" alt="Ø´Ø¹Ø§Ø± ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©" class="member-logo">
                            <div class="member-details">
                                <label for="member_islamic_affairs">Ù…Ù†Ø¯ÙˆØ¨ ÙØ±Ø¹ ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© ÙˆØ§Ù„Ø¯Ø¹ÙˆØ© ÙˆØ§Ù„Ø¥Ø±Ø´Ø§Ø¯ Ø¨Ù…Ø­Ø§ÙØ¸Ø©
                                    Ø¬Ø¯Ø©:</label>
                                <input type="text" id="member_islamic_affairs" name="member_islamic_affairs">

                                <label for="signature_canvas_member1">ğŸ–‹ï¸ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</label>
                                <canvas id="signature_canvas_member1" class="signature-pad"></canvas>
                                <button type="button" class="clear-signature"
                                    data-canvas-id="signature_canvas_member1">Ù…Ø³Ø­</button>
                                <input type="hidden" id="signature_member1" name="signature_member1">

                                <label for="date_member1">ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                                <input type="text" id="date_member1" name="date_member1">
                                </div>
                        </div>

                        <div class="member-input">
                            <img src="iemg/Ø´Ø¹Ø§Ø± Ù‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù…Ø± Ø¨Ø§Ù„Ù…Ø¹Ø±ÙˆÙ.svg" alt="Ø´Ø¹Ø§Ø± Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§Ù…Ø± Ø¨Ø§Ù„Ù…Ø¹Ø±ÙˆÙ"
                                class="member-logo">
                            <div class="member-details">
                                <label for="member_haia">Ù…Ù†Ø¯ÙˆØ¨ ÙØ±Ø¹ Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§Ù…Ø± Ø¨Ø§Ù„Ù…Ø¹Ø±ÙˆÙ ÙˆØ§Ù„Ù†Ù‡ÙŠ Ø¹Ù† Ø§Ù„Ù…Ù†ÙƒØ± Ø¨Ù…Ø­Ø§ÙØ¸Ø©
                                    Ø¬Ø¯Ø©:</label>
                                <input type="text" id="member_haia" name="member_haia">

                                <label for="signature_canvas_member2">ğŸ–‹ï¸ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</label>
                                <canvas id="signature_canvas_member2" class="signature-pad"></canvas>
                                <button type="button" class="clear-signature"
                                    data-canvas-id="signature_canvas_member2">Ù…Ø³Ø­</button>
                                <input type="hidden" id="signature_member2" name="signature_member2">

                                <label for="date_member2">ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                                <input type="text" id="date_member2" name="date_member2">
                                </div>
                        </div>

                        <div class="member-input">
                            <img src="iemg/Ø§Ù„Ø´Ø±Ø·Ø©.svg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ" class="member-logo">
                            <div class="member-details">
                                <label for="member_criminal_investigation">Ù…Ù†Ø¯ÙˆØ¨ ÙØ±Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø¬Ø¯Ø©:</label>
                                <input type="text" id="member_criminal_investigation"
                                    name="member_criminal_investigation">

                                <label for="signature_canvas_member3">ğŸ–‹ï¸ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</label>
                                <canvas id="signature_canvas_member3" class="signature-pad"></canvas>
                                <button type="button" class="clear-signature"
                                    data-canvas-id="signature_canvas_member3">Ù…Ø³Ø­</button>
                                <input type="hidden" id="signature_member3" name="signature_member3">

                                <label for="date_member3">ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                                <input type="text" id="date_member3" name="date_member3">
                                </div>
                        </div>

                        <div class="member-input">
                            <img src="iemg/Makkah Region.svg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©" class="member-logo">
                            <div class="member-details">
                                <label for="member_committee_head">Ù…Ù†Ø¯ÙˆØ¨ Ø±Ø¦ÙŠØ³ Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø¬Ø¯Ø©:</label>
                                <input type="text" id="member_committee_head" name="member_committee_head">

                                <label for="signature_canvas_member4">ğŸ–‹ï¸ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</label>
                                <canvas id="signature_canvas_member4" class="signature-pad"></canvas>
                                <button type="button" class="clear-signature"
                                    data-canvas-id="signature_canvas_member4">Ù…Ø³Ø­</button>
                                <input type="hidden" id="signature_member4" name="signature_member4">

                                <label for="date_member4">ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                                <input type="text" id="date_member4" name="date_member4">
                                </div>
                        </div>
                    </div>
                </div> <button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
                <button type="button" id="update-button">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <button type="button" id="print-pdf-button">Ø·Ø¨Ø§Ø¹Ø© PDF</button>

                <div id="msg" class="success"></div>
            </form>
        </div>

        <div class="report-section-container"> <h2 class="report-title hidden" id="report-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
            <div class="report-container powerbi-container hidden" id="report-section">
                <iframe
                    src="https://app.powerbi.com/view?r=eyJrIjoiY2M3M2RiY2EtNGU2Yy00YzNhLTgxNGUtNzhhMmE3ZjYzYjE4IiwidCI6IjJkMzE5NGUzLTE2NTQtNDZiZC1iYWUyLWFkMzdiYTExYjBhZSIsImMiOjl9&embedImagePlaceholder=true"
                    frameborder="0" allowFullScreen="true"></iframe>
            </div>
        </div>
    </div>

    <footer>
        <p>"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ø¹Ø§ØµÙ… Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ 2025"</p>
    </footer>

    <button id="scroll-to-top" class="hidden">â¬†</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/l10n/ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr-hijri/dist/flatpickr-hijri.min.js"></script>


    <script>
       document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM Content Loaded.");

    const inputLink = document.getElementById('input-link');
    const reportLink = document.getElementById('report-link');
    const inputSection = document.getElementById('input-section');
    const reportSection = document.getElementById('report-section');
    const reportTitle = document.getElementById('report-title');
    const container = document.querySelector('.container');
    const form = document.getElementById('form');
    const finalEvaluationDiv = document.getElementById('final-evaluation');
    const printPdfButton = document.getElementById('print-pdf-button');
    const getLocationButton = document.getElementById('get-location-button');
    const practitionerLocationCoordsInput = document.getElementById('practitioner_location_coords');
    const practitionerLocationInput = document.getElementById('practitioner_location');
    const msgDiv = document.getElementById('msg');
    const scrollToTopButton = document.getElementById('scroll-to-top');

    const signaturePads = {};

    function resizeAllSignaturePads() {
        for (const key in signaturePads) {
            if (signaturePads[key] && signaturePads[key].resizeCanvas) {
                signaturePads[key].resizeCanvas();
            }
        }
    }
    
    function initSignaturePad(canvasId, hiddenInputId) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) {
            console.error(`Canvas with ID ${canvasId} not found.`);
            return null;
        }
        const ctx = canvas.getContext('2d');
        if (!ctx) {
            console.error(`2D context not available for canvas ID ${canvasId}.`);
            return null;
        }
        const hiddenInput = document.getElementById(hiddenInputId);
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            let imageData = null;
            if (canvas.width > 0 && canvas.height > 0) { 
                try {
                    imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                } catch (e) {
                    console.warn(`Could not get image data for canvas ${canvasId} before resize:`, e);
                }
            }

            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);

            if (imageData && imageData.width > 0 && imageData.height > 0) {
                try {
                    ctx.putImageData(imageData, 0, 0);
                } catch (e) {
                    console.warn(`Could not put image data back for canvas ${canvasId} after resize:`, e);
                }
            }
            
            ctx.strokeStyle = '#1E3A8A';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }

        if (canvas.offsetParent !== null) {
             resizeCanvas();
        }


        canvas.addEventListener('mousedown', (e) => {
            if (canvas.getAttribute('disabled') === 'true') return; 
            isDrawing = true;
            const currentRect = canvas.getBoundingClientRect();
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            [lastX, lastY] = [(clientX - currentRect.left) / (currentRect.width / canvas.clientWidth), (clientY - currentRect.top) / (currentRect.height / canvas.clientHeight)];
        });
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', () => { 
            isDrawing = false; 
            if(hiddenInput) hiddenInput.value = canvas.getDataURL();
        });
        canvas.addEventListener('mouseout', () => {
            if(isDrawing && hiddenInput) hiddenInput.value = canvas.getDataURL();
            isDrawing = false;
        });

        canvas.addEventListener('touchstart', (e) => {
            if (canvas.getAttribute('disabled') === 'true') return; 
            e.preventDefault();
            isDrawing = true;
            const currentRect = canvas.getBoundingClientRect();
            const clientX = e.touches[0].clientX;
            const clientY = e.touches[0].clientY;
            [lastX, lastY] = [(clientX - currentRect.left) / (currentRect.width / canvas.clientWidth), (clientY - currentRect.top) / (currentRect.height / canvas.clientHeight)];
        }, { passive: false });
        canvas.addEventListener('touchmove', (e) => {
            if (canvas.getAttribute('disabled') === 'true') return; 
            e.preventDefault();
            draw(e);
        }, { passive: false });
        canvas.addEventListener('touchend', () => {
            isDrawing = false;
            if(hiddenInput) hiddenInput.value = canvas.getDataURL();
        });
        canvas.addEventListener('touchcancel', () => isDrawing = false);

        function draw(e) {
            if (!isDrawing) return;
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            if (!clientX || !clientY) return;


            const currentRect = canvas.getBoundingClientRect();
            const x = (clientX - currentRect.left) / (currentRect.width / canvas.clientWidth);
            const y = (clientY - currentRect.top) / (currentRect.height / canvas.clientHeight);

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            [lastX, lastY] = [x, y];
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (hiddenInput) hiddenInput.value = ''; 
        }

        const clearButton = document.querySelector(`button[data-canvas-id="${canvasId}"]`);
        if (clearButton) {
            clearButton.addEventListener('click', clearCanvas);
        }

        canvas.getDataURL = function() {
            if (this.width === 0 || this.height === 0) {
                console.warn(`Canvas ID ${this.id} has zero dimensions. Cannot get image data.`);
                return ''; 
            }
            // Check if canvas is empty
            const imageData = ctx.getImageData(0, 0, this.width, this.height); 
            let isEmpty = true;
            for (let i = 0; i < imageData.data.length; i += 4) {
                if (imageData.data[i + 3] !== 0) { // Check alpha channel
                    isEmpty = false;
                    break;
                }
            }
            if (isEmpty) return ''; // Return empty string if canvas is blank
            return this.toDataURL('image/png'); 
        };
        
        canvas.fromDataURL = function(dataURL) {
            if (!dataURL) {
                clearCanvas();
                return;
            }
            const img = new Image();
            const dpr = window.devicePixelRatio || 1; 
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // Draw image considering dpr for correct scaling on display
                ctx.drawImage(img, 0, 0, canvas.width / dpr, canvas.height / dpr); 
            };
            img.src = dataURL;
        };

        return {
            canvas,
            clearCanvas,
            fromDataURL: canvas.fromDataURL, 
            resizeCanvas 
        };
    }

    signaturePads.member1 = initSignaturePad('signature_canvas_member1', 'signature_member1');
    signaturePads.member2 = initSignaturePad('signature_canvas_member2', 'signature_member2');
    signaturePads.member3 = initSignaturePad('signature_canvas_member3', 'signature_member3');
    signaturePads.member4 = initSignaturePad('signature_canvas_member4', 'signature_member4');

    const loginOverlay = document.getElementById('login-overlay');
    const usernameInput = document.getElementById('username-input');
    const passwordInput = document.getElementById('password-input');
    const loginButton = document.getElementById('login-button');
    const guestButton = document.getElementById('guest-button');
    const loginMessage = document.getElementById('login-message');
    const loginToggleLink = document.getElementById('login-toggle-link');
    const logoutLink = document.getElementById('logout-link');

    let currentUserRole = localStorage.getItem('userRole') || 'guest';

    function updateUIForRole(role) {
            const isGuest = role === 'guest';
            const isAdmin = role === 'admin';

            loginOverlay.style.display = 'none'; // Hide overlay once role is determined or guest/login happens
            
            // Links visibility
            inputLink.style.display = 'inline-block'; // Always visible
            reportLink.style.display = 'inline-block'; // Always visible
            loginToggleLink.style.display = isGuest ? 'inline-block' : 'none';
            logoutLink.style.display = isAdmin ? 'inline-block' : 'none';

            // Search container visibility (always visible for both, but functionality differs)
            document.getElementById('search-container').style.display = 'flex';

            // Form elements enabling/disabling
            form.querySelectorAll('input:not(#search-id), select, textarea, .clear-signature, #get-location-button').forEach(element => {
                if (isAdmin) {
                    element.removeAttribute('disabled');
                } else {
                    element.setAttribute('disabled', 'true');
                }
            });
             // Signature canvases
            Object.values(signaturePads).forEach(pad => {
                if (pad && pad.canvas) {
                    if (isAdmin) {
                        pad.canvas.removeAttribute('disabled');
                         pad.canvas.style.cursor = 'crosshair';
                    } else {
                        pad.canvas.setAttribute('disabled', 'true');
                        pad.canvas.style.cursor = 'not-allowed';
                    }
                }
            });


            // Form action buttons
            form.querySelector('button[type="submit"]').style.display = isAdmin ? 'inline-block' : 'none';
            document.getElementById('update-button').style.display = isAdmin ? 'inline-block' : 'none';
            document.getElementById('print-pdf-button').style.display = 'inline-block'; // Always visible for printing current view
            
            // Search button should always be enabled
            document.getElementById('search-button').removeAttribute('disabled');


            if (isAdmin) {
                 // If admin, ensure input section is shown by default if nothing else dictates it
                if (inputSection.classList.contains('hidden') && reportSection.classList.contains('hidden')) {
                    inputSection.classList.remove('hidden');
                    reportSection.classList.add('hidden');
                    reportTitle.classList.add('hidden');
                    container.style.gridTemplateColumns = '1fr'; // Ensure single column for input
                    resizeAllSignaturePads();
                } else if (!inputSection.classList.contains('hidden')) {
                     resizeAllSignaturePads(); // Resize if input section is already visible
                }
            } else { // Guest
                // For guests, default to input view (read-only) if no specific section is active
                 if (inputSection.classList.contains('hidden') && reportSection.classList.contains('hidden')) {
                    inputSection.classList.remove('hidden');
                    reportSection.classList.add('hidden');
                    reportTitle.classList.add('hidden');
                    container.style.gridTemplateColumns = '1fr';
                 } else if (reportSection.classList.contains('hidden')) { // If input section is what should be shown
                    inputSection.classList.remove('hidden');
                    reportSection.classList.add('hidden');
                    reportTitle.classList.add('hidden');
                    container.style.gridTemplateColumns = '1fr';
                 }
                // No need to resize signature pads for guest as they are disabled
            }
        }


    loginButton.addEventListener('click', function() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        if (username === 'asim' && password === '7878') {
            localStorage.setItem('userRole', 'admin');
            currentUserRole = 'admin';
            updateUIForRole('admin');
            loginMessage.textContent = ''; 
            msgDiv.textContent = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ ÙƒÙ…Ø³Ø¤ÙˆÙ„.';
            msgDiv.style.color = 'var(--secondary-color)';
            // Ensure input section is active for admin after login
            inputSection.classList.remove('hidden');
            reportSection.classList.add('hidden');
            reportTitle.classList.add('hidden');
            container.style.gridTemplateColumns = '1fr';
            resizeAllSignaturePads();

        } else {
            loginMessage.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.';
            msgDiv.textContent = ''; 
        }
    });

    guestButton.addEventListener('click', function() {
        localStorage.setItem('userRole', 'guest');
        currentUserRole = 'guest';
        updateUIForRole('guest');
        loginMessage.textContent = ''; 
        msgDiv.textContent = 'ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
        msgDiv.style.color = 'var(--primary-color)';
        // Ensure input section is active for guest after choosing guest mode
        inputSection.classList.remove('hidden');
        reportSection.classList.add('hidden');
        reportTitle.classList.add('hidden');
        container.style.gridTemplateColumns = '1fr';
    });

    loginToggleLink.addEventListener('click', function(e) {
        e.preventDefault();
        loginOverlay.style.display = 'flex';
        loginMessage.textContent = '';
        usernameInput.value = '';
        passwordInput.value = '';
        usernameInput.focus();
    });

    logoutLink.addEventListener('click', function(e) {
        e.preventDefault();
        localStorage.removeItem('userRole');
        currentUserRole = 'guest';
        clearFormAndSignatures(); // Clear form on logout
        updateUIForRole('guest'); // This will show login overlay via loginToggleLink behavior or set to guest view
        loginOverlay.style.display = 'flex'; // Explicitly show login overlay
        msgDiv.textContent = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­.';
        msgDiv.style.color = 'var(--secondary-color)';
    });
    
    // Initial UI setup based on stored role or default to guest (which might show login)
    if (!localStorage.getItem('userRole')) {
        loginOverlay.style.display = 'flex'; // Show login if no role is stored
    } else {
        updateUIForRole(currentUserRole);
    }


    inputLink.addEventListener('click', function(e) {
        e.preventDefault();
        inputSection.classList.remove('hidden');
        reportSection.classList.add('hidden');
        reportTitle.classList.add('hidden');
        container.style.gridTemplateColumns = '1fr'; // Ensure single column layout
        if (currentUserRole === 'admin') { // Resize pads only if admin and input section is shown
            resizeAllSignaturePads();
        }
    });

    reportLink.addEventListener('click', function(e) {
        e.preventDefault();
        inputSection.classList.add('hidden');
        reportSection.classList.remove('hidden');
        reportTitle.classList.remove('hidden');
        container.style.gridTemplateColumns = '1fr'; // Ensure single column layout for report too
    });
    

    function clearFormAndSignatures() {
        form.reset();
        for (const key in signaturePads) {
            if (signaturePads[key] && signaturePads[key].clearCanvas) { 
                signaturePads[key].clearCanvas();
            }
        }
        if (typeof updateEvaluationAndWarnings === "function") {
             updateEvaluationAndWarnings(); 
        }
        msgDiv.textContent = ''; 
        msgDiv.style.color = '';
        document.getElementById('id').removeAttribute('readonly'); // Make ID field editable again if it was made readonly
    }
    
    function updateEvaluationAndWarnings() {
        let negativeConditionsMet = false;
        const criteriaElements = form.querySelectorAll('.criterion');
        const totalCriteria = criteriaElements.length;
        let checkedCriteriaCount = 0;

        criteriaElements.forEach(criterion => {
            const selectedOption = criterion.querySelector('input[type="radio"]:checked');
            const warningMessage = criterion.querySelector('.warning-message');

            if (warningMessage) {
                warningMessage.classList.add('hidden');
            }

            if (selectedOption) {
                checkedCriteriaCount++;
                const value = selectedOption.value;
                const criterionType = criterion.getAttribute('data-criterion-type'); // Get type from attribute

                if ( (criterionType === 'positive' && value === 'Ù„Ø§') || 
                     (criterionType === 'negative' && value === 'Ù†Ø¹Ù…') ) {
                    negativeConditionsMet = true;
                    if (warningMessage) warningMessage.classList.remove('hidden');
                }
            }
        });

        let evaluationText = '';
        let evaluationClass = '';

        if (negativeConditionsMet) {
            evaluationText = 'âŒ ØºÙŠØ± Ù…Ø¤Ù‡Ù„ Ù„ÙˆØ¬ÙˆØ¯ Ù…Ø®Ø§Ù„ÙØ§Øª.';
            evaluationClass = 'not-qualified';
        } else if (checkedCriteriaCount === totalCriteria && totalCriteria > 0) {
            evaluationText = 'âœ… Ù…Ø¤Ù‡Ù„.';
            evaluationClass = 'qualified';
        } else if (totalCriteria > 0 && checkedCriteriaCount < totalCriteria) {
            evaluationText = 'âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ….';
            evaluationClass = 'needs-review';
        } else { // No criteria or none checked
            evaluationText = 'Ù„Ù… ÙŠØªÙ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø¨Ø¹Ø¯.';
            evaluationClass = ''; // No specific class or 'needs-review'
        }


        finalEvaluationDiv.textContent = evaluationText;
        finalEvaluationDiv.className = 'final-evaluation'; // Reset class
        if(evaluationClass) finalEvaluationDiv.classList.add(evaluationClass);
    }
    form.querySelectorAll('.criterion input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', updateEvaluationAndWarnings);
    });
    updateEvaluationAndWarnings(); 


    if (getLocationButton) {
        getLocationButton.addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    practitionerLocationCoordsInput.value = `${lat}, ${lon}`;
                    // You might want to use a geocoding service here to get a human-readable address if needed
                    // For now, we just store the coordinates.
                    practitionerLocationInput.value = `${lat}, ${lon}`; 
                    msgDiv.textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­!';
                    msgDiv.style.color = 'var(--secondary-color)';
                }, function(error) {
                    console.error("Error getting location: ", error);
                    msgDiv.textContent = `Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${error.message}`;
                    msgDiv.style.color = 'var(--no-color)';
                });
            } else {
                msgDiv.textContent = "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹.";
                msgDiv.style.color = 'var(--warning-color)';
            }
        });
    }
    
    const searchIdInput = document.getElementById('search-id');
    const searchButton = document.getElementById('search-button');
    // const editButton = document.getElementById('update-button'); // ØªÙ… ØªØ¹Ø±ÙŠÙÙ‡ Ø£Ø¹Ù„Ø§Ù‡ Ùƒ update-button

    searchButton.addEventListener('click', function() {
        const practitionerId = searchIdInput.value.trim();
        if (!practitionerId) {
            msgDiv.textContent = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø²Ø§ÙˆÙ„ Ù„Ù„Ø¨Ø­Ø«.";
            msgDiv.style.color = 'var(--warning-color)';
            return;
        }
        // Simulating data fetch - In a real app, this would be an API call
        const data = localStorage.getItem(`practitioner_${practitionerId}`);
        if (data) {
            const practitionerData = JSON.parse(data);
            Object.keys(practitionerData).forEach(key => {
                const field = form.elements[key];
                if (field) {
                    if (field.type === 'radio') {
                        // For radio buttons, find the one with matching name and value
                        form.querySelectorAll(`input[name="${key}"][value="${practitionerData[key]}"]`).forEach(rb => rb.checked = true);
                    } else if (field.type === 'checkbox') {
                        field.checked = practitionerData[key];
                    } else if (key.startsWith('signature_member')) {
                        const canvasId = `signature_canvas_${key.replace('signature_', '')}`;
                        if(signaturePads[key.replace('signature_', '')] && signaturePads[key.replace('signature_', '')].fromDataURL) {
                            signaturePads[key.replace('signature_', '')].fromDataURL(practitionerData[key]);
                        }
                    } else {
                        field.value = practitionerData[key];
                    }
                }
            });
            msgDiv.textContent = `ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²Ø§ÙˆÙ„: ${practitionerData.name || practitionerId}.`;
            msgDiv.style.color = 'var(--secondary-color)';
            document.getElementById('id').setAttribute('readonly', 'true'); // Make ID readonly after search
            updateEvaluationAndWarnings(); // Update evaluation based on loaded criteria
            if (currentUserRole === 'admin') resizeAllSignaturePads(); // Resize pads if admin
        } else {
            msgDiv.textContent = `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø²Ø§ÙˆÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: ${practitionerId}. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.`;
            msgDiv.style.color = 'var(--warning-color)';
            clearFormAndSignatures(); // Clear form for new entry
            form.elements['id'].value = practitionerId; // Pre-fill the ID for new entry
            document.getElementById('id').removeAttribute('readonly');
        }
    });

    form.addEventListener('submit', function(event) {
        event.preventDefault();
        if (currentUserRole !== 'admin') {
            msgDiv.textContent = 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
            msgDiv.style.color = 'var(--no-color)';
            return;
        }

        const formData = new FormData(form);
        const data = {};
        let allCriteriaChecked = true;
        const criteriaElements = form.querySelectorAll('.criterion');
        if (criteriaElements.length > 0) {
            criteriaElements.forEach(criterion => {
                const radioName = criterion.querySelector('input[type="radio"]').name;
                if (!formData.has(radioName)) {
                    allCriteriaChecked = false;
                }
            });
        }


        if (!allCriteriaChecked && criteriaElements.length > 0) {
            msgDiv.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ ØªÙ‚ÙŠÙŠÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.';
            msgDiv.style.color = 'var(--warning-color)';
            // Scroll to the criteria section
            const criteriaSection = document.querySelector('.criteria-section');
            if (criteriaSection) {
                criteriaSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            return; 
        }


        for (let [key, value] of formData.entries()) {
            data[key] = value;
        }
        
        // Add signature data
        for(const padKey in signaturePads){
            if(signaturePads[padKey] && signaturePads[padKey].canvas){
                 const hiddenInputId = signaturePads[padKey].canvas.id.replace('signature_canvas_', 'signature_');
                 data[hiddenInputId] = signaturePads[padKey].canvas.getDataURL(); // Get data from canvas directly
            }
        }


        // Store data in localStorage (replace with actual API call in a real app)
        const practitionerId = data.id;
        if (!practitionerId) {
            msgDiv.textContent = 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù…Ø·Ù„ÙˆØ¨ Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
            msgDiv.style.color = 'var(--no-color)';
            return;
        }
        localStorage.setItem(`practitioner_${practitionerId}`, JSON.stringify(data));
        
        msgDiv.textContent = 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„/Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!';
        msgDiv.style.color = 'var(--secondary-color)';
        document.getElementById('id').setAttribute('readonly', 'true'); // Make ID readonly after successful submit
        // setTimeout(clearFormAndSignatures, 2000); // Optionally clear form after a delay
    });

    document.getElementById('update-button').addEventListener('click', function() {
        if (currentUserRole !== 'admin') {
            msgDiv.textContent = 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
            msgDiv.style.color = 'var(--no-color)';
            return;
        }
        const practitionerId = form.elements['id'].value;
        if (!practitionerId || !localStorage.getItem(`practitioner_${practitionerId}`)) {
            msgDiv.textContent = 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø²Ø§ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ØŒ Ø£Ùˆ Ù‚Ù… Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.';
            msgDiv.style.color = 'var(--warning-color)';
            return;
        }
        // Trigger form submission logic which now handles saving
        form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
        // The message will be "ØªÙ… Ø¥Ø±Ø³Ø§Ù„/Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!" from the submit handler
    });

    // --- ÙˆØ¸ÙŠÙØ© Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© PDF ---
    printPdfButton.addEventListener('click', function() {
        const elementToPrint = document.getElementById('printable-form-content');
        const practitionerId = document.getElementById('id').value || "Ø¨ÙŠØ§Ù†Ø§Øª_Ù…Ø²Ø§ÙˆÙ„";
        const practitionerName = document.getElementById('name').value || "ØºÙŠØ±_Ù…Ø¹Ø±ÙˆÙ";

        if (!elementToPrint) {
            console.error('Error: Element with ID "printable-form-content" not found.');
            msgDiv.textContent = 'Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø®ØµØµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©.';
            msgDiv.style.color = 'var(--no-color)';
            return;
        }

        msgDiv.textContent = 'ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...';
        msgDiv.style.color = 'var(--primary-color)';

        const opt = {
            margin:       [15, 10, 15, 10], // [top, left, bottom, right] in mm - increased top/bottom margin
            filename:     `Ù…Ø­Ø¶Ø±_${practitionerName.replace(/\s+/g, '_')}_${practitionerId}.pdf`,
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2, logging: false, dpi: 192, letterRendering: true, useCORS: true, scrollY: -window.scrollY },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
            pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] }
        };
        
        // Temporarily modify elements for PDF generation
        const elementsToHideForPdf = form.querySelectorAll('button:not(#print-pdf-button), .clear-signature'); // Hide action buttons
        elementsToHideForPdf.forEach(el => el.classList.add('pdf-hide-temp'));

        const tempStyle = document.createElement('style');
        tempStyle.innerHTML = `
            .pdf-hide-temp { display: none !important; }
            #printable-form-content input, 
            #printable-form-content textarea, 
            #printable-form-content select { 
                border: 1px solid #ccc !important; /* Add a light border to see fields in PDF */
                background-color: #f9f9f9 !important; /* Light background for fields */
            }
            #printable-form-content .signature-pad {
                 border: 1px dashed #ccc !important; /* Visual cue for signature area if empty */
            }
             /* Ensure signature images are visible if canvases are replaced by images by html2pdf */
            #printable-form-content .signature-pad img {
                max-width: 100%; height: auto; display: block;
            }
        `;
        document.head.appendChild(tempStyle);


        html2pdf().from(elementToPrint).set(opt).save().then(() => {
            msgDiv.textContent = 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­.';
            msgDiv.style.color = 'var(--secondary-color)';
            elementsToHideForPdf.forEach(el => el.classList.remove('pdf-hide-temp'));
            document.head.removeChild(tempStyle);
        }).catch((error) => {
            console.error('Error generating PDF:', error);
            msgDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF.';
            msgDiv.style.color = 'var(--no-color)';
            elementsToHideForPdf.forEach(el => el.classList.remove('pdf-hide-temp'));
            document.head.removeChild(tempStyle);
        });
    });


    flatpickr("#dob", {
        locale: "ar",
        dateFormat: "Y-m-d",
        altInput: true,
        altFormat: "j F Y", // More readable format
        allowInput: true
    });
    flatpickr("#meeting_date", {
        locale: "ar",
        dateFormat: "Y-m-d",
        defaultDate: "today", // Default to today
        altInput: true,
        altFormat: "j F Y",
        allowInput: true
    });
    // Member dates
    const memberDateInputs = ['#date_member1', '#date_member2', '#date_member3', '#date_member4'];
    memberDateInputs.forEach(selector => {
        flatpickr(selector, {
            locale: "ar",
            dateFormat: "Y-m-d",
            defaultDate: "today",
            altInput: true,
            altFormat: "j F Y",
            allowInput: true
        });
    });


    window.addEventListener('scroll', function() {
        if (window.scrollY > 200) { 
            scrollToTopButton.classList.add('visible');
        } else {
            scrollToTopButton.classList.remove('visible');
        }
    });

    scrollToTopButton.addEventListener('click', function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });
    
    // Call on load to set initial state
    // updateUIForRole(currentUserRole); // Already called after login/guest choice logic
    if (!localStorage.getItem('userRole')) { // If no role, and overlay is shown, ensure form is disabled initially
        updateUIForRole('guest'); // Set to guest view (disabled form) until login
    }


}); // End DOMContentLoaded
    </script>
</body>

</html>